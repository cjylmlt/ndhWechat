define("statistics/components/date-range2.js",["statistics/components/event-emitter.js","biz_web/ui/dateRange.js","biz_common/moment.js","common/wx/report_util.js"],function(t){
"use strict";
function e(t){
s.call(this),t=this.settings=$.extend({},D,t),this.dateObj={
needCompare:!1,
startDate:t.startDate,
endDate:t.endDate,
startCompareDate:t.startCompareDate||"",
endCompareDate:t.endCompareDate||""
},this.cid=o++,this.isEmit=!0,this.$single=h(this.settings.singleContainer),this.$compare=h(this.settings.compareContainer),
this.$compareBtn=h(this.settings.compareBtn),this._init();
}
function a(t){
var e=n().subtract(1,"days").format(r),a=n().subtract(parseInt(t),"days").format(r),s={
startDate:a,
endDate:e
};
return s;
}
var s=t("statistics/components/event-emitter.js"),i=t("biz_web/ui/dateRange.js"),n=t("biz_common/moment.js"),r="YYYY-MM-DD",o=0,d="js_date_container",m=t("common/wx/report_util.js"),h=jQuery,D={
needCompare:!0,
minValidDate:"315507600"
},c=$.extend(e.prototype,s.prototype);
return c._init=function(){
this.initSingle(),this.initCompare(),this.initCompareButton();
},c.initSingle=function(){
var t=this;
if(this.settings.single)var e=!0;
this.settings.single?this.dateRange=this.singleRange=i({
container:$(this.settings.singleContainer).find(".js_date_range_drop"),
stopToday:!0,
isTodayValid:!1,
startDate:this.dateObj.startDate||"",
endDate:this.dateObj.endDate||"",
singleCompare:this.settings.single,
autoSubmit:e,
theme:"ta",
success:function(e){
t.dateObj.startDate=e.startDate,t.dateObj.endDate=e.endDate,t.emitDate();
}
}):(this.singleRange=m.initDateRange({
begintime:this.settings.startDate,
endtime:this.settings.endDate,
minValidDate:this.settings.minValidDate,
dropDom:$(this.settings.singleContainer).find(".js_date_filter_drop"),
dateDom:$(this.settings.singleContainer).find(".js_date_range_drop"),
callback:function(e,a){
t.dateObj.startDate=e,t.dateObj.endDate=a,t.emitDate();
}
}),this.dateRange=this.singleRange.dateRange);
},c.initCompare=function(){
var t=this;
if(this.settings.single)var e=!0;
this.range1=i({
container:$(this.settings.compareContainer).find(".js_date_range_drop1"),
stopToday:!0,
isTodayValid:!1,
startDate:this.dateObj.startDate||"",
endDate:this.dateObj.endDate||"",
singleCompare:this.settings.single,
autoSubmit:e,
theme:"ta",
success:function(e){
t.dateObj.startDate=e.startDate,t.dateObj.endDate=e.endDate,t.dateRange.setDate(e),
t.emitDate();
}
}),this.range2=i({
container:$(this.settings.compareContainer).find(".js_date_range_drop2"),
stopToday:!0,
isTodayValid:!1,
startDate:this.dateObj.startDate||"",
endDate:this.dateObj.endDate||"",
singleCompare:this.settings.single,
autoSubmit:e,
theme:"ta",
success:function(e){
t.dateObj.startCompareDate=e.startDate,t.dateObj.endCompareDate=e.endDate,t.emitDate();
}
});
},c.initCompareButton=function(){
var t=this;
this.$compareBtn.on("click",function(){
t.dateObj.needCompare=!t.dateObj.needCompare,t.dateObj.needCompare?t._disableCompareBtn():t._enableCompareBtn(),
t.emitDate();
});
},c.setCompareDateWithDate=function(t){
var e=n(t.startDate),a=n(t.endDate),s=(parseInt(a.format("X"))-parseInt(e.format("X")))/86400,i=n(t.startDate).subtract(1,"days"),o=n(t.startDate).subtract(s+1,"days"),d=e.format(r),m=a.format(r),h=o.format(r),D=i.format(r);
this.range1.setDate({
startDate:d,
endDate:m
}),this.range2.setDate({
startDate:h,
endDate:D
}),this.dateObj.startDate=d,this.dateObj.endDate=m,this.dateObj.startCompareDate=h,
this.dateObj.endCompareDate=D;
},c.emitDate=function(){
this.emit("date-change",this.dateObj);
},c._initTabToDateMap=function(){
var t=this;
this.tabsMap={},this.$el.find(".btn_default").each(function(e,s){
var i=$(s),n=i.attr("range"),r=a(n);
t.tabsMap[r.startDate+r.endDate]=e;
});
},c._initState=c.resetState=function(){
var t={
startDate:this.settings.startDate,
endDate:this.settings.endDate
};
this.setCompareDateWithDate(t),this._selectTabByMyDate(),this.clearCompare(),this.settings.single&&this.$el.find(".btn_default").remove();
},c.setDate=function(t){
this.dateRange.setDate(t),this.setCompareDateWithDate(t);
},c.clearCompare=function(){
this.dateObj.needCompare=!1,this._enableCompareBtn();
},c._enableCompareBtn=function(){
var t=this;
t.$single.show(),t.$compare.hide(),t.$compareBtn.html("按时间对比");
},c._disableCompareBtn=function(){
var t=this;
t.$single.hide(),t.$compare.show(),t.$compareBtn.html("取消对比"),t.setCompareDateWithDate(t.dateObj);
},c._initDateRange=function(){
var t=this,e=d+this.cid,a="js_compare_btn"+this.cid;
if(this.compareBtnId=a,this.$el.find(".td_data_container").eq(0).attr("id",e),this.$el.find(".btn_primary").eq(0).attr("id",a),
this.settings.single)var s=!0;
this.dateRange=i({
container:"#"+e,
stopToday:!0,
isTodayValid:!1,
startDate:this.dateObj.startDate||"",
endDate:this.dateObj.endDate||"",
singleCompare:this.settings.single,
autoSubmit:s,
startCompareDate:this.dateObj.startCompareDate||"",
endCompareDate:this.dateObj.endCompareDate||"",
needCompare:this.settings.needCompare,
theme:"ta",
compareTrigger:"compare_trigger_"+this.cid,
replaceBtn:a,
success:function(e){
e.needCompare=t.dateObj.needCompare,t.dateObj.needCompare||t.setCompareDateWithDate(e),
t.dateObj=e,t.emitDate(),t._selectTabByMyDate();
}
});
},c._selectTabByMyDate=function(){
var t=this._getTabIndexByDate(this.dateObj),e=-1;
t!==e?this._selectTab(t):(this.range=null,this._deselectAll());
},c._selectTab=function(t){
this.$el.find(".btn_default").eq(t).addClass("selected").siblings().removeClass("selected");
},c._deselectAll=function(){
this.$el.find(".btn_default").removeClass("selected");
},c._getTabIndexByDate=function(t){
var e=t.startDate+t.endDate;
for(var a in this.tabsMap)if(a===e)return this.tabsMap[a];
return-1;
},e;
});define("statistics/components/tab-bar2.js",["tpl/statistics/tab-bar2.html.js","statistics/components/event-emitter.js"],function(t){
"use strict";
function e(t){
i.call(this);
var t=t||{};
this.settings=$.extend({},n,t),this.el=null,this.$el=null,this.render(),this.listenActions(),
this.activate(0);
}
var s=template.compile(t("tpl/statistics/tab-bar2.html.js")),i=t("statistics/components/event-emitter.js"),n={
name:"Untitled Tab Bar",
tabs:[{}]
},a=$.extend(e.prototype,i.prototype);
return a.render=function(){
this.el=s(this.settings),this.$el=$(this.el);
},a.listenActions=function(){
var t=this;
this.$el.find("li a").each(function(e,s){
var i=$(s);
i.on("click",function(s){
s.stopPropagation(),t.activate(e);
});
});
},a.activate=function(t,e){
this.$el.find("li.selected").removeClass("selected"),this.$el.find("li").eq(t).addClass("selected");
var s=this.settings.tabs[t];
e||this.emit("tab-selected",t,s);
},e;
});define("biz_common/moment.js",[],function(t,e,n){
function s(t,e){
return function(n){
return c(t.call(this,n),e);
};
}
function r(t){
return function(e){
return this.lang().ordinal(t.call(this,e));
};
}
function a(){}
function i(t){
u(this,t);
}
function o(t){
var e=this._data={},n=t.years||t.year||t.y||0,s=t.months||t.month||t.M||0,r=t.weeks||t.week||t.w||0,a=t.days||t.day||t.d||0,i=t.hours||t.hour||t.h||0,o=t.minutes||t.minute||t.m||0,u=t.seconds||t.second||t.s||0,c=t.milliseconds||t.millisecond||t.ms||0;
this._milliseconds=c+1e3*u+6e4*o+36e5*i,this._days=a+7*r,this._months=s+12*n,e.milliseconds=c%1e3,
u+=d(c/1e3),e.seconds=u%60,o+=d(u/60),e.minutes=o%60,i+=d(o/60),e.hours=i%24,a+=d(i/24),
a+=7*r,e.days=a%30,s+=d(a/30),e.months=s%12,n+=d(s/12),e.years=n;
}
function u(t,e){
for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);
return t;
}
function d(t){
return 0>t?Math.ceil(t):Math.floor(t);
}
function c(t,e){
for(var n=t+"";n.length<e;)n="0"+n;
return n;
}
function h(t,e,n){
var s,r=e._milliseconds,a=e._days,i=e._months;
r&&t._d.setTime(+t+r*n),a&&t.date(t.date()+a*n),i&&(s=t.date(),t.date(1).month(t.month()+i*n).date(Math.min(s,t.daysInMonth())));
}
function f(t){
return"[object Array]"===Object.prototype.toString.call(t);
}
function l(t,e){
var n,s=Math.min(t.length,e.length),r=Math.abs(t.length-e.length),a=0;
for(n=0;s>n;n++)~~t[n]!==~~e[n]&&a++;
return a+r;
}
function _(t,e){
return e.abbr=t,A[t]||(A[t]=new a),A[t].set(e),A[t];
}
function m(e){
return e?(!A[e]&&Z&&t("./lang/"+e),A[e]):C.fn._lang;
}
function M(t){
return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"");
}
function y(t){
var e,n,s=t.match(E);
for(e=0,n=s.length;n>e;e++)s[e]=ie[s[e]]?ie[s[e]]:M(s[e]);
return function(r){
var a="";
for(e=0;n>e;e++)a+="function"==typeof s[e].call?s[e].call(r,t):s[e];
return a;
};
}
function Y(t,e){
function n(e){
return t.lang().longDateFormat(e)||e;
}
for(var s=5;s--&&J.test(e);)e=e.replace(J,n);
return se[e]||(se[e]=y(e)),se[e](t);
}
function D(t){
switch(t){
case"DDDD":
return $;

case"YYYY":
return I;

case"YYYYY":
return X;

case"S":
case"SS":
case"SSS":
case"DDD":
return N;

case"MMM":
case"MMMM":
case"dd":
case"ddd":
case"dddd":
case"a":
case"A":
return j;

case"X":
return G;

case"Z":
case"ZZ":
return R;

case"T":
return B;

case"MM":
case"DD":
case"YY":
case"HH":
case"hh":
case"mm":
case"ss":
case"M":
case"D":
case"d":
case"H":
case"h":
case"m":
case"s":
return V;

default:
return new RegExp(t.replace("\\",""));
}
}
function p(t,e,n){
var s,r=n._a;
switch(t){
case"M":
case"MM":
r[1]=null==e?0:~~e-1;
break;

case"MMM":
case"MMMM":
s=m(n._l).monthsParse(e),null!=s?r[1]=s:n._isValid=!1;
break;

case"D":
case"DD":
case"DDD":
case"DDDD":
null!=e&&(r[2]=~~e);
break;

case"YY":
r[0]=~~e+(~~e>68?1900:2e3);
break;

case"YYYY":
case"YYYYY":
r[0]=~~e;
break;

case"a":
case"A":
n._isPm="pm"===(e+"").toLowerCase();
break;

case"H":
case"HH":
case"h":
case"hh":
r[3]=~~e;
break;

case"m":
case"mm":
r[4]=~~e;
break;

case"s":
case"ss":
r[5]=~~e;
break;

case"S":
case"SS":
case"SSS":
r[6]=~~(1e3*("0."+e));
break;

case"X":
n._d=new Date(1e3*parseFloat(e));
break;

case"Z":
case"ZZ":
n._useUTC=!0,s=(e+"").match(te),s&&s[1]&&(n._tzh=~~s[1]),s&&s[2]&&(n._tzm=~~s[2]),
s&&"+"===s[0]&&(n._tzh=-n._tzh,n._tzm=-n._tzm);
}
null==e&&(n._isValid=!1);
}
function g(t){
var e,n,s=[];
if(!t._d){
for(e=0;7>e;e++)t._a[e]=s[e]=null==t._a[e]?2===e?1:0:t._a[e];
s[3]+=t._tzh||0,s[4]+=t._tzm||0,n=new Date(0),t._useUTC?(n.setUTCFullYear(s[0],s[1],s[2]),
n.setUTCHours(s[3],s[4],s[5],s[6])):(n.setFullYear(s[0],s[1],s[2]),n.setHours(s[3],s[4],s[5],s[6])),
t._d=n;
}
}
function w(t){
var e,n,s=t._f.match(E),r=t._i;
for(t._a=[],e=0;e<s.length;e++)n=(D(s[e]).exec(r)||[])[0],n&&(r=r.slice(r.indexOf(n)+n.length)),
ie[s[e]]&&p(s[e],n,t);
t._isPm&&t._a[3]<12&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),g(t);
}
function T(t){
for(var e,n,s,r,a=99;t._f.length;){
if(e=u({},t),e._f=t._f.pop(),w(e),n=new i(e),n.isValid()){
s=n;
break;
}
r=l(e._a,n.toArray()),a>r&&(a=r,s=n);
}
u(t,s);
}
function k(t){
var e,n=t._i;
if(q.exec(n)){
for(t._f="YYYY-MM-DDT",e=0;4>e;e++)if(Q[e][1].exec(n)){
t._f+=Q[e][0];
break;
}
R.exec(n)&&(t._f+=" Z"),w(t);
}else t._d=new Date(n);
}
function v(t){
var e=t._i,n=P.exec(e);
void 0===e?t._d=new Date:n?t._d=new Date(+n[1]):"string"==typeof e?k(t):f(e)?(t._a=e.slice(0),
g(t)):t._d=new Date(e instanceof Date?+e:e);
}
function S(t,e,n,s,r){
return r.relativeTime(e||1,!!n,t,s);
}
function L(t,e,n){
var s=U(Math.abs(t)/1e3),r=U(s/60),a=U(r/60),i=U(a/24),o=U(i/365),u=45>s&&["s",s]||1===r&&["m"]||45>r&&["mm",r]||1===a&&["h"]||22>a&&["hh",a]||1===i&&["d"]||25>=i&&["dd",i]||45>=i&&["M"]||345>i&&["MM",U(i/30)]||1===o&&["y"]||["yy",o];
return u[2]=e,u[3]=t>0,u[4]=n,S.apply({},u);
}
function b(t,e,n){
var s=n-e,r=n-t.day();
return r>s&&(r-=7),s-7>r&&(r+=7),Math.ceil(C(t).add("d",r).dayOfYear()/7);
}
function F(t){
var e=t._i,n=t._f;
return null===e||""===e?null:("string"==typeof e&&(t._i=e=m().preparse(e)),C.isMoment(e)?(t=u({},e),
t._d=new Date(+e._d)):n?f(n)?T(t):w(t):v(t),new i(t));
}
function H(t,e){
C.fn[t]=C.fn[t+"s"]=function(t){
var n=this._isUTC?"UTC":"";
return null!=t?(this._d["set"+n+e](t),this):this._d["get"+n+e]();
};
}
function O(t){
C.duration.fn[t]=function(){
return this._data[t];
};
}
function z(t,e){
C.duration.fn["as"+t]=function(){
return+this/e;
};
}
for(var C,W,x="2.0.0",U=Math.round,A={},Z="undefined"!=typeof n&&n.exports,P=/^\/?Date\((\-?\d+)/i,E=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,J=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,V=/\d\d?/,N=/\d{1,3}/,$=/\d{3}/,I=/\d{1,4}/,X=/[+\-]?\d{1,6}/,j=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,R=/Z|[\+\-]\d\d:?\d\d/i,B=/T/i,G=/[\+\-]?\d+(\.\d{1,3})?/,q=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,K="YYYY-MM-DDTHH:mm:ssZ",Q=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],te=/([\+\-]|\d\d)/gi,ee="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ne={
Milliseconds:1,
Seconds:1e3,
Minutes:6e4,
Hours:36e5,
Days:864e5,
Months:2592e6,
Years:31536e6
},se={},re="DDD w W M D d".split(" "),ae="M D H h m s w W".split(" "),ie={
M:function(){
return this.month()+1;
},
MMM:function(t){
return this.lang().monthsShort(this,t);
},
MMMM:function(t){
return this.lang().months(this,t);
},
D:function(){
return this.date();
},
DDD:function(){
return this.dayOfYear();
},
d:function(){
return this.day();
},
dd:function(t){
return this.lang().weekdaysMin(this,t);
},
ddd:function(t){
return this.lang().weekdaysShort(this,t);
},
dddd:function(t){
return this.lang().weekdays(this,t);
},
w:function(){
return this.week();
},
W:function(){
return this.isoWeek();
},
YY:function(){
return c(this.year()%100,2);
},
YYYY:function(){
return c(this.year(),4);
},
YYYYY:function(){
return c(this.year(),5);
},
a:function(){
return this.lang().meridiem(this.hours(),this.minutes(),!0);
},
A:function(){
return this.lang().meridiem(this.hours(),this.minutes(),!1);
},
H:function(){
return this.hours();
},
h:function(){
return this.hours()%12||12;
},
m:function(){
return this.minutes();
},
s:function(){
return this.seconds();
},
S:function(){
return~~(this.milliseconds()/100);
},
SS:function(){
return c(~~(this.milliseconds()/10),2);
},
SSS:function(){
return c(this.milliseconds(),3);
},
Z:function(){
var t=-this.zone(),e="+";
return 0>t&&(t=-t,e="-"),e+c(~~(t/60),2)+":"+c(~~t%60,2);
},
ZZ:function(){
var t=-this.zone(),e="+";
return 0>t&&(t=-t,e="-"),e+c(~~(10*t/6),4);
},
X:function(){
return this.unix();
}
};re.length;)W=re.pop(),ie[W+"o"]=r(ie[W]);
for(;ae.length;)W=ae.pop(),ie[W+W]=s(ie[W],2);
for(ie.DDDD=s(ie.DDD,3),a.prototype={
set:function(t){
var e,n;
for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e;
},
_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
months:function(t){
return this._months[t.month()];
},
_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
monthsShort:function(t){
return this._monthsShort[t.month()];
},
monthsParse:function(t){
var e,n,s;
for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=C([2e3,e]),
s="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(s.replace(".",""),"i")),
this._monthsParse[e].test(t))return e;
},
_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
weekdays:function(t){
return this._weekdays[t.day()];
},
_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
weekdaysShort:function(t){
return this._weekdaysShort[t.day()];
},
_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
weekdaysMin:function(t){
return this._weekdaysMin[t.day()];
},
_longDateFormat:{
LT:"h:mm A",
L:"MM/DD/YYYY",
LL:"MMMM D YYYY",
LLL:"MMMM D YYYY LT",
LLLL:"dddd, MMMM D YYYY LT"
},
longDateFormat:function(t){
var e=this._longDateFormat[t];
return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){
return t.slice(1);
}),this._longDateFormat[t]=e),e;
},
meridiem:function(t,e,n){
return t>11?n?"pm":"PM":n?"am":"AM";
},
_calendar:{
sameDay:"[Today at] LT",
nextDay:"[Tomorrow at] LT",
nextWeek:"dddd [at] LT",
lastDay:"[Yesterday at] LT",
lastWeek:"[last] dddd [at] LT",
sameElse:"L"
},
calendar:function(t,e){
var n=this._calendar[t];
return"function"==typeof n?n.apply(e):n;
},
_relativeTime:{
future:"in %s",
past:"%s ago",
s:"a few seconds",
m:"a minute",
mm:"%d minutes",
h:"an hour",
hh:"%d hours",
d:"a day",
dd:"%d days",
M:"a month",
MM:"%d months",
y:"a year",
yy:"%d years"
},
relativeTime:function(t,e,n,s){
var r=this._relativeTime[n];
return"function"==typeof r?r(t,e,n,s):r.replace(/%d/i,t);
},
pastFuture:function(t,e){
var n=this._relativeTime[t>0?"future":"past"];
return"function"==typeof n?n(e):n.replace(/%s/i,e);
},
ordinal:function(t){
return this._ordinal.replace("%d",t);
},
_ordinal:"%d",
preparse:function(t){
return t;
},
postformat:function(t){
return t;
},
week:function(t){
return b(t,this._week.dow,this._week.doy);
},
_week:{
dow:0,
doy:6
}
},C=function(t,e,n){
return F({
_i:t,
_f:e,
_l:n,
_isUTC:!1
});
},C.utc=function(t,e,n){
return F({
_useUTC:!0,
_isUTC:!0,
_l:n,
_i:t,
_f:e
});
},C.unix=function(t){
return C(1e3*t);
},C.duration=function(t,e){
var n,s=C.isDuration(t),r="number"==typeof t,a=s?t._data:r?{}:t;
return r&&(e?a[e]=t:a.milliseconds=t),n=new o(a),s&&t.hasOwnProperty("_lang")&&(n._lang=t._lang),
n;
},C.version=x,C.defaultFormat=K,C.lang=function(t,e){
return t?(e?_(t,e):A[t]||m(t),void(C.duration.fn._lang=C.fn._lang=m(t))):C.fn._lang._abbr;
},C.langData=function(t){
return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),m(t);
},C.isMoment=function(t){
return t instanceof i;
},C.isDuration=function(t){
return t instanceof o;
},C.fn=i.prototype={
clone:function(){
return C(this);
},
valueOf:function(){
return+this._d;
},
unix:function(){
return Math.floor(+this._d/1e3);
},
toString:function(){
return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ");
},
toDate:function(){
return this._d;
},
toJSON:function(){
return C.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");
},
toArray:function(){
var t=this;
return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()];
},
isValid:function(){
return null==this._isValid&&(this._isValid=this._a?!l(this._a,(this._isUTC?C.utc(this._a):C(this._a)).toArray()):!isNaN(this._d.getTime())),
!!this._isValid;
},
utc:function(){
return this._isUTC=!0,this;
},
local:function(){
return this._isUTC=!1,this;
},
format:function(t){
var e=Y(this,t||C.defaultFormat);
return this.lang().postformat(e);
},
add:function(t,e){
var n;
return n="string"==typeof t?C.duration(+e,t):C.duration(t,e),h(this,n,1),this;
},
subtract:function(t,e){
var n;
return n="string"==typeof t?C.duration(+e,t):C.duration(t,e),h(this,n,-1),this;
},
diff:function(t,e,n){
var s,r,a=this._isUTC?C(t).utc():C(t).local(),i=6e4*(this.zone()-a.zone());
return e&&(e=e.replace(/s$/,"")),"year"===e||"month"===e?(s=432e5*(this.daysInMonth()+a.daysInMonth()),
r=12*(this.year()-a.year())+(this.month()-a.month()),r+=(this-C(this).startOf("month")-(a-C(a).startOf("month")))/s,
"year"===e&&(r/=12)):(s=this-a-i,r="second"===e?s/1e3:"minute"===e?s/6e4:"hour"===e?s/36e5:"day"===e?s/864e5:"week"===e?s/6048e5:s),
n?r:d(r);
},
from:function(t,e){
return C.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e);
},
fromNow:function(t){
return this.from(C(),t);
},
calendar:function(){
var t=this.diff(C().startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";
return this.format(this.lang().calendar(e,this));
},
isLeapYear:function(){
var t=this.year();
return t%4===0&&t%100!==0||t%400===0;
},
isDST:function(){
return this.zone()<C([this.year()]).zone()||this.zone()<C([this.year(),5]).zone();
},
day:function(t){
var e=this._isUTC?this._d.getUTCDay():this._d.getDay();
return null==t?e:this.add({
d:t-e
});
},
startOf:function(t){
switch(t=t.replace(/s$/,"")){
case"year":
this.month(0);

case"month":
this.date(1);

case"week":
case"day":
this.hours(0);

case"hour":
this.minutes(0);

case"minute":
this.seconds(0);

case"second":
this.milliseconds(0);
}
return"week"===t&&this.day(0),this;
},
endOf:function(t){
return this.startOf(t).add(t.replace(/s?$/,"s"),1).subtract("ms",1);
},
isAfter:function(t,e){
return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+C(t).startOf(e);
},
isBefore:function(t,e){
return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+C(t).startOf(e);
},
isSame:function(t,e){
return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)===+C(t).startOf(e);
},
zone:function(){
return this._isUTC?0:this._d.getTimezoneOffset();
},
daysInMonth:function(){
return C.utc([this.year(),this.month()+1,0]).date();
},
dayOfYear:function(t){
var e=U((C(this).startOf("day")-C(this).startOf("year"))/864e5)+1;
return null==t?e:this.add("d",t-e);
},
isoWeek:function(t){
var e=b(this,1,4);
return null==t?e:this.add("d",7*(t-e));
},
week:function(t){
var e=this.lang().week(this);
return null==t?e:this.add("d",7*(t-e));
},
lang:function(t){
return void 0===t?this._lang:(this._lang=m(t),this);
}
},W=0;W<ee.length;W++)H(ee[W].toLowerCase().replace(/s$/,""),ee[W]);
H("year","FullYear"),C.fn.days=C.fn.day,C.fn.weeks=C.fn.week,C.fn.isoWeeks=C.fn.isoWeek,
C.duration.fn=o.prototype={
weeks:function(){
return d(this.days()/7);
},
valueOf:function(){
return this._milliseconds+864e5*this._days+2592e6*this._months;
},
humanize:function(t){
var e=+this,n=L(e,!t,this.lang());
return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n);
},
lang:C.fn.lang
};
for(W in ne)ne.hasOwnProperty(W)&&(z(W,ne[W]),O(W.toLowerCase()));
return z("Weeks",6048e5),C.lang("zh-cn",{
months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),
monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),
weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),
weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),
weekdaysMin:"日_一_二_三_四_五_六".split("_"),
longDateFormat:{
LT:"Ah点mm",
L:"YYYY年MMMD日",
LL:"YYYY年MMMD日",
LLL:"YYYY年MMMD日LT",
LLLL:"YYYY年MMMD日ddddLT",
l:"YYYY年MMMD日",
ll:"YYYY年MMMD日",
lll:"YYYY年MMMD日LT",
llll:"YYYY年MMMD日ddddLT"
},
meridiem:function(t,e){
return 9>t?"早上":11>t&&30>e?"上午":13>t&&30>e?"中午":18>t?"下午":"晚上";
},
calendar:{
sameDay:"[今天]LT",
nextDay:"[明天]LT",
nextWeek:"[下]ddddLT",
lastDay:"[昨天]LT",
lastWeek:"[上]ddddLT",
sameElse:"L"
},
ordinal:function(t,e){
switch(e){
case"d":
case"D":
case"DDD":
return t+"日";

case"M":
return t+"月";

case"w":
case"W":
return t+"周";

default:
return t;
}
},
relativeTime:{
future:"%s内",
past:"%s前",
s:"几秒",
m:"1分钟",
mm:"%d分钟",
h:"1小时",
hh:"%d小时",
d:"1天",
dd:"%d天",
M:"1个月",
MM:"%d个月",
y:"1年",
yy:"%d年"
}
}),C;
});define("statistics/user_stat/summary/summary.js",["biz_common/moment.js","statistics/components/tab-bar2.js","statistics/components/date-range2.js","statistics/components/date-range.js","biz_web/ui/dropdown.js","common/wx/Cgi.js","common/wx/report_util.js","statistics/user_stat/summary/summary-state.js","statistics/user_stat/summary/summary-chart.js","statistics/user_stat/common.js","statistics/common.js","statistics/user_stat/top.js"],function(e){
"use strict";
function t(){
a(),U(),E(),o(),D(),n(),r(),setTimeout(k),I();
}
function a(){
s(),l(_t,dt),at.draw();
}
function n(){
var e={
download:1,
begin_date:tt.tableBeginDate,
end_date:tt.tableEndDate,
source:"99999999"
};
tt.needCompare&&(e.begin_date=tt.drawBeginDate,e.end_date=tt.drawEndDate,e.compare_begin_date=tt.beginCompareDate,
e.compare_end_date=tt.endCompareDate,e.compare=1);
var t="/misc/useranalysis?";
for(var a in e)t+="&"+a+"="+e[a];
t=wx.url(t),q("#js_download_detail").attr("href",t);
}
function r(){
q("#js_download_detail").on("click",function(){
rt.clickReport(rt.reportKeys.USER_SUM_EXCEL);
});
}
function s(){
var e=i();
u(e);
}
function i(){
for(var e=tt.userStatList,t=e[dt],a=["cancel_user","cumulate_user","netgain_user","new_user"],n={},r=0,s=a.length;s>r;r++){
var i=a[r],o=t[i],u=e[pt][i],l=e[ft][i],d=e[mt][i];
n[i]={
count:o,
day:c(o,u),
week:c(o,l),
month:c(o,d)
};
}
return n;
}
function o(){
jt=new H({
needCompare:!1,
startDate:_t,
endDate:dt
}),jt.$el.find(".btn_default, .time_lable, .setup").remove(),jQuery("#js_table_date").html(jt.$el),
jt.on("date-change",function(e){
tt.tableBeginDate=e.startDate,tt.tableEndDate=e.endDate,wt=!0,A(!0);
});
}
function c(e,t){
if(0==t)return"--";
var a=(e-t)/t*100;
return a%1==0?a:a.toFixed(1);
}
function u(e){
$("#js_keydata").html(template("js_key_data_tpl",e));
}
function l(e,t){
C(),h(),tt.detailData=[];
var a=tt.tableUserStateList||tt.userStatList;
it(e,t,function(e){
tt.detailData.push(a[e]);
},!0),tt.desc=!0,tt.sortKey="date",tt.currentPage=1,tt.pageTotalCount=tt.detailData.length,
gt=14,d(),_(),p(1);
}
function d(){
q("th.rank_area i").show();
}
function _(){
et.initPager({
total_count:tt.pageTotalCount,
container:"#js_pagebar",
count:gt,
currentPage:tt.currentPage,
callback:function(e){
e!=tt.currentPage&&(tt.currentPage=e,tt.needCompare?v(e):p(e));
}
}),m();
}
function m(){
q("#js_pagebar a.page_prev").click(function(){
rt.clickReport(rt.reportKeys.USER_SUM_NAV_LEFT);
}),q("#js_pagebar a.page_next").click(function(){
rt.clickReport(rt.reportKeys.USER_SUM_NAV_RIGHT);
}),q("#js_pagebar a.page_go").click(function(){
rt.clickReport(rt.reportKeys.USER_SUM_NAV_JUMP);
});
}
function p(e){
var t=(e-1)*gt,a=t+gt;
tt.currentDetail=tt.detailData.slice(t,a),f();
}
function f(){
var e=template("js_detail_item",{
data:tt.currentDetail
}),t=q("#js_detail");
t.html(e);
}
function D(){
q(document).on("click","th.rank_area",null,function(){
var e=q(this),t=e.data("type");
t!==tt.sortKey?(g(e),tt.sortKey=t,tt.desc=!1):tt.desc=!tt.desc,b(e,tt.desc),w();
});
}
function g(e){
e.siblings("th").find("i").show();
}
function b(e,t){
t?(e.find("i.arrow_down").show(),e.find("i.arrow_up").hide()):(e.find("i.arrow_down").hide(),
e.find("i.arrow_up").show());
}
function w(){
var e=tt.sortKey,t=tt.desc;
tt.detailData.sort(function(a,n){
var r,s;
return"date"===e?(r=+J(a.date).format("X"),s=+J(n.date).format("X")):(r=a[e],s=n[e]),
t?s-r:r-s;
}),p(tt.currentPage);
}
function j(){
if(S(),y(),tt.compareDetailData=[],tt.compareUserStatList.length>tt.userStatList.length)var e=tt.beginCompareDate,t=tt.endCompareDate,a=!1,n=tt.beginDate,r=tt.compareUserStatList.length;else var e=tt.drawBeginDate,t=tt.drawEndDate,a=!0,n=tt.beginCompareDate,r=tt.userStatList.length;
it(e,t,function(e){
var t,s;
a?(t=tt.userStatList[e],s=tt.compareUserStatList[n]):(t=tt.userStatList[n],s=tt.compareUserStatList[e]);
var i={
i:r,
first:t,
second:s
};
r--,n=J(n).add(1,"days").format(lt),tt.compareDetailData.push(i);
}),tt.compareDetailData.reverse(),tt.currentPage=1,tt.pageTotalCount=tt.compareDetailData.length,
gt=7,_(),v(1);
}
function v(e){
var t=(e-1)*gt,a=t+gt;
tt.currentCompareDetail=tt.compareDetailData.slice(t,a);
var n=template("js_detail_compare_item",{
data:tt.currentCompareDetail
}),r=q("#js_compare_table tbody");
r.html(n);
}
function h(){
q("#js_compare_table").hide();
}
function S(){
q("#js_compare_table").show();
}
function y(){
q("#js_single_table").hide();
}
function C(){
q("#js_single_table").show();
}
function U(){
ct=new F({
name:"关键指标详解",
tabs:[{
text:"新增人数",
index:"new_user"
},{
text:"取消关注人数",
index:"cancel_user"
},{
text:"净增人数",
index:"netgain_user"
},{
text:"累积人数",
index:"cumulate_user"
}]
}),q("#js_tab_bar_wrp").html(ct.$el);
}
function E(){
ut=new Q({
singleContainer:"#js_single",
compareContainer:"#js_compare",
compareBtn:"#js_compare_btn",
needCompare:!0,
startDate:_t,
endDate:dt
});
}
function k(){
ct.on("tab-selected",function(e,t){
L(t),tt.index=t.index,M(),at.draw();
});
var e=[{
name:"全部来源",
value:99999999
},{
name:"公众号搜索",
value:1
},{
name:"扫描二维码",
value:30
},{
name:"图文页右上角菜单",
value:43
},{
name:"图文页内公众号名称",
value:57
},{
name:"名片分享",
value:17
},{
name:"公众号文章广告",
value:75
},{
name:"朋友圈广告",
value:78
},{
name:"支付后关注",
value:51
},{
name:"其他合计",
value:0
}];
ht&&e.splice(6,2),St=new W({
container:"#js_sources",
label:"全部来源",
data:e,
callback:function(e,t){
e=""+e,tt.source!==e&&(x(e),wt=!1,tt.source=e,tt.sourceText=t,tt.needCompare?T():A());
}
}),ut.on("date-change",function(e){
wt=!0,$.extend(tt,e),tt.beginDate=tt.drawBeginDate=e.startDate,tt.drawEndDate=e.endDate,
tt.beginCompareDate=e.startCompareDate,delete tt.startDate,delete tt.startCompareDate,
jt.setDate({
startDate:e.startDate,
endDate:e.endDate
}),tt.needCompare?(q("#js_table_date").hide(),T()):(q("#js_table_date").show(),A());
}),q("#js_compare_btn0").on("click",function(){
R();
});
}
function R(){
rt.clickReport(rt.reportKeys.USER_SUM_COMPARE);
}
function x(e){
var t="USER_SUM_SRC_"+e;
rt.clickReport(rt.reportKeys[t]);
}
function L(e){
var t="USER_SUM_TAB_"+e.index.toUpperCase();
rt.clickReport(rt.reportKeys[t]);
}
function M(){
"new_user"===tt.index?(tt.source="99999999",St.reset(),yt.show()):yt.hide();
}
function K(e,t,a){
var n="/misc/useranalysis?&begin_date=%s&end_date=%s&source=%s",r=n.sprintf(e,t,a);
return r;
}
function A(e){
if(e)var t=tt.tableBeginDate,a=tt.tableEndDate;else var t=tt.beginDate,a=tt.endDate;
var r=wt?tt.source+",99999999":tt.source;
ht&&0==tt.source&&(r=tt.source+",75,78");
var s=K(t,a,r);
X(),st([s],function(r){
var s=r.category_list;
if(wt){
var i=N(s).list,o=s.slice(0,s.length-1);
e?(t=tt.tableBeginDate,a=tt.tableEndDate,tt.tableUserStateList=Y(t,a,i),l(t,a)):(tt.sourceData=V(t,a,o),
tt.userStatList=Y(t,a,i),tt.tableUserStateList=tt.userStatList,at.draw(),l(t,a)),
tt.tableBeginDate=t,tt.tableEndDate=a,n();
}else tt.sourceData=V(t,a,s),at.draw();
G();
},P);
}
function P(e,t,a){
if(0!==a.base_resp.ret)return Z.show(a),void G();
var n=+new Date-e,r=rt.reportKeys.LOAD_USER_SUMMARY_DATA_AJAX_KEY,s=rt.ajaxReport;
s(r,n,wx.data.uin);
}
function T(){
var e=tt.beginDate,t=tt.endDate,a=wt?tt.source+",99999999":tt.source,n=K(e,t,a),r=tt.beginCompareDate,s=tt.endCompareDate,i=K(r,s,a);
X(),st([n,i],function(a,n){
var i=a.category_list,o=n.category_list;
if(wt){
var c=tt.rawList=N(i).list,u=tt.rawCompareList=N(o).list;
tt.userStatList=Y(e,t,c),tt.compareUserStatList=Y(r,s,u);
var l=i.slice(0,i.length-1),d=o.slice(0,o.length-1);
tt.sourceData=V(e,t,l),tt.compareSourceData=V(r,s,d),B();
}else tt.sourceData=V(e,t,i),tt.compareSourceData=V(r,s,o),at.draw();
G();
},P);
}
function B(){
j(),at.draw(),n();
}
function Y(e,t,a){
for(var n={},r=0,s=a.length;s>r;r++){
var i=a[r];
n[i.date]=i;
}
var o=0;
return it(e,t,function(e){
o++,z(n,e);
}),n.length=o,n;
}
function z(e,t){
e[t]||(e[t]={
cancel_user:0,
cumulate_user:0,
date:t,
netgain_user:0,
new_user:0,
isPatch:!0
});
}
function O(e,t){
for(var a=["new_user"],n=0,r=a.length;r>=n;n++){
var s=a[n];
e[s]+=t[s];
}
}
function V(e,t,a){
for(var n=Y(e,t,a[0].list),r=1,s=a.length;s>r;r++)for(var i=a[r].list,o=0,c=i.length;c>o;o++){
var u=i[o];
O(n[u.date],u);
}
return n;
}
function N(e){
return e[e.length-1];
}
function X(){
Ct.show();
}
function G(){
Ct.hide();
}
function I(){
"0"===window.cgiData.load_done?$(".js_delay_info").show():$(".js_delay_info").hide();
}
var J=e("biz_common/moment.js"),F=e("statistics/components/tab-bar2.js"),Q=e("statistics/components/date-range2.js"),H=e("statistics/components/date-range.js"),W=e("biz_web/ui/dropdown.js"),q=jQuery,Z=e("common/wx/Cgi.js"),et=e("common/wx/report_util.js"),tt=e("statistics/user_stat/summary/summary-state.js"),at=e("statistics/user_stat/summary/summary-chart.js"),nt=e("statistics/user_stat/common.js"),rt=e("statistics/common.js"),st=(nt.log,
nt.mGet),it=nt.loopDay,ot=e("statistics/user_stat/top.js");
ot.selected("user_stat");
var ct=(q("#js_actions"),null),ut=null,lt="YYYY-MM-DD",dt=J().add("d",-1).format(lt),_t=J().add("d",-30).format(lt),mt=J().add("d",-31).format(lt),pt=J(dt).add("d",-1).format(lt),ft=J(dt).add("d",-7).format(lt),Dt=J(dt).subtract(1,"months").format(lt),gt=14,bt=cgiData.list[0].list,wt=!1,jt=null,vt=Y(mt,dt,bt),ht=!0;
q.extend(tt,{
rawList:bt,
rawCompareList:null,
userStatList:vt,
compareUserStatList:null,
beginDate:Dt,
endDate:dt,
needCompare:!1,
sourceData:vt,
compareSourceData:null,
sourceText:"全部",
pageSize:0,
currentPage:0,
sortKey:"date",
desc:!0,
detailData:null,
currentDetail:null,
compareDetailData:null,
currentCompareDetail:null,
drawBeginDate:_t,
drawEndDate:dt,
tableBeginDate:_t,
tableEndDate:dt,
index:"new_user",
source:"99999999"
}),template.helper("keyPercent",function(e){
return"--"==e?"&nbsp;&nbsp;&nbsp;--":(e=1*e,e>=0?'<i class="icon_up" title="上升"></i>%s%'.sprintf(e):'<i class="icon_down" title="下降"></i>%s%'.sprintf(-e));
}),t();
var St,yt=q("#js_sources"),Ct=$("div.wrp_overview div.wrp_loading");
rt.help("#js_table_ask","#js_table_ask_content"),rt.help("#js_ask_trend","#js_ask_trend_content"),
rt.help("#js_ask_keys","#js_ask_keys_content"),seajs.use("statistics/report.js",function(e){
e(rt.logKeys.USER_SUMMARY_NETWORK_OVERTIME,rt.logKeys.USER_SUMMARY_JS_OVERTIME,rt.reportKeys.USER_SUMMARY_PAGE);
});
});